# Hospital Readmission Analytics Pipeline Configuration

sources:
  encounters:
    path: "gs://unitypoint-hospital-data/encounters"
    format: "json"
    expected_volume: 10000  # records per day

  labs:
    path: "gs://unitypoint-hospital-data/labs"
    format: "json"
    expected_volume: 50000  # records per day

layers:
  bronze:
    path: "/mnt/data/bronze"
    format: "delta"
    partitioned_by: ["year", "month", "day"]

  silver:
    path: "/mnt/data/silver"
    format: "delta"
    data_quality_enabled: true
    quarantine_path: "/mnt/data/quarantine"

  gold:
    readmission_metrics:
      path: "/mnt/data/gold/readmission_metrics"
      z_order_by: ["patient_mrn", "metric_date"]
    hospital_metrics:
      path: "/mnt/data/gold/hospital_metrics"
      z_order_by: ["hospital", "metric_date"]

data_quality:
  validation_rules:
    - rule: "date_logic"
      condition: "discharge_date >= admission_date"
    - rule: "required_fields"
      columns: ["patient_mrn", "encounter_id", "admission_date", "diagnosis"]
  quarantine:
    enabled: true
    path: "/mnt/data/quarantine/encounters"

optimization:
  enabled: true
  z_ordering: true
  target_file_size_mb: 128
  vacuum_retention_hours: 168  # 7 days
  analyze_enabled: true

cluster:
  spark_version: "13.3.x-scala2.12"
  node_type: "i3.xlarge"
  min_workers: 2
  max_workers: 10

monitoring:
  enabled: true
  alert_thresholds:
    quality_pass_rate: 95.0
    query_latency_sec: 30.0
